#!/usr/bin/env bash

# ===== 設定 =====
PLAYER="mpg123"   # mp3なら mpg123
VOICES=(./v{1..9}.mp3)

RANDOM_MODE=0
RANDOM_PID=""

RAINBOW=0
RAINBOW_PID=""

# ===== AA =====
AA=$(cat <<'EOF'
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠄⠄⡀⠄⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠠⢐⣠⡤⠶⢛⣛⡭⢭⡭⠭⠭⢍⣙⣛⣛⠶⠤⣄⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢀⠄⣨⠶⡫⢕⢝⣗⣕⡺⣎⣭⠷⠛⠉⢡⡖⣒⡄⡀⠈⠉⠓⢮⡛⣦⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣀⡾⢭⡮⡪⢸⡳⢸⣧⠞⠉⡀⢀⣀⡤⠴⠶⠒⠚⠛⠛⠛⠓⠲⠦⣬⣷⠹⡌⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢀⢞⣴⣿⣝⢕⢅⣋⡿⠁⡀⣤⠞⠉⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠉⠿⣄⣀⣬⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣴⣱⡗⢝⢮⠝⡧⣾⠁⣀⠶⠉⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣄⡀⡀⡀⡀⠈⢦⡀⡀⢀⡞⠄⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣾⡜⣽⣕⣼⣽⣼⠡⣃⠟⡠⡀⡀⡀⡀⡀⡀⣄⡀⡀⠁⡀⡀⡀⡀⡀⢷⡀⡀⠄⡀⡀⠙⡄⡀⢧⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠠⣼⣽⣷⢽⡯⢿⣾⣸⢸⢲⠠⡀⣸⡀⡀⡀⡀⡀⣽⣰⡀⡀⡀⡀⣼⡀⡀⢸⠾⣄⡀⡀⢠⡀⠘⡀⡀⢧⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢠⢧⣿⣿⣿⣬⡎⠇⢇⡿⢠⡀⡀⡇⡀⡀⢀⡀⢐⠋⡀⡀⡀⡀⣰⡇⡀⡀⣸⡀⠈⠖⠶⡦⠶⠦⡇⡀⡀⣇⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣾⣿⣿⣿⣿⣇⡾⣼⣴⣡⠟⡀⡀⡇⢸⡀⠁⢀⠏⡀⠧⡤⠶⠶⠃⠙⠉⠁⡀⡀⣉⡛⠿⡌⡄⡀⡀⡀⡀⠘⡌⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠂⡯⣿⣿⣿⠿⣳⢡⡫⡇⣇⢸⡀⡀⠈⠉⣿⠉⣠⠟⠉⡀⣀⡀⡀⡀⡀⡀⢀⣶⢿⡀⡀⢳⡀⠸⣀⡀⡀⡀⡀⢻⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢠⣳⣿⣿⣿⣶⢃⢯⡾⡀⡇⢸⡀⡀⡀⡀⢽⠈⠋⣾⣿⣇⡀⠹⣄⡀⡀⡀⢺⡷⣿⣖⣿⣻⠓⠦⡀⡀⠉⠲⡀⠈⡄⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢸⣺⣿⠿⣯⠏⡟⡾⡐⠉⡀⢸⡀⡀⡀⠨⢹⡀⡀⣿⣷⣦⣿⣟⣟⡇⡀⡀⡀⠓⠶⠷⠿⠿⣄⣀⠇⡄⠉⡀⢹⡀⣇⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣾⣵⢿⣶⢋⢿⡿⡀⡇⡀⡀⣿⡀⡀⡀⡀⣹⡀⡞⠘⣄⣀⣿⠛⠛⢀⡴⢟⡶⠄⡀⡀⠆⡀⡀⠲⡀⠈⡀⡀⣸⡀⢹⠁⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣿⣃⡿⣡⣫⢟⣤⠞⡀⡀⡼⡏⡀⡀⡀⡀⣿⡀⠳⡤⠟⡀⡀⡀⢰⠁⡀⡀⡇⡀⡀⡀⠈⡀⡀⡀⡀⡀⡀⣠⠃⡀⢸⠰⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠂⠿⣩⢞⡾⠁⡿⡀⡀⡀⡀⠇⡇⡀⡀⡀⡀⡏⡆⠈⡀⡀⡀⡀⡀⡏⡀⡀⣸⡀⡀⡀⡀⡀⡀⠁⠒⠂⣀⠾⠁⡀⡀⣸⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢈⡿⣽⠞⡡⢤⠞⠁⡀⡀⡀⣼⢠⡀⡀⡀⡀⡀⠇⡀⡀⢠⠃⡀⡀⡀⣇⣀⡴⠁⡀⡀⡀⡀⡀⣀⣤⠖⠉⣼⡀⡀⡀⡀⡟⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢂⠟⠋⡀⣰⡀⡀⣀⣠⣤⠶⠶⢿⣹⡀⡀⣸⡀⢰⢛⢶⠶⣤⠤⢤⣤⣤⣤⢤⠤⣤⡴⢶⠛⠉⠁⡀⡀⡀⡀⡇⠂⡀⡀⢠⢁⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠘⣖⢉⠉⡀⣠⢟⡾⣡⡄⡀⡀⡀⡏⡀⡀⡏⡀⡿⡯⣺⢹⡬⢷⣄⠙⠛⠉⡀⢠⢿⣿⣿⢿⡀⡀⡀⡀⡀⢀⠁⡀⢰⡀⡟⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢠⢗⣾⣼⣳⠁⢠⡶⣰⣀⣠⢾⣀⣼⡌⢧⣽⡺⠷⡋⡆⢙⠛⠚⡀⣿⣿⣿⡵⢼⡀⡀⡀⡀⡀⡾⢀⡴⣏⠞⠄⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠄⣟⣗⡏⠁⡀⡀⣿⣿⡇⡀⣼⣹⢸⢽⣿⣮⢝⡳⣸⠇⡧⠚⠚⣄⢰⣽⣫⣪⡗⡞⡀⡀⡀⡀⡀⠈⡀⡀⡇⠁⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣶⣽⢵⢓⡀⡀⡀⠙⠿⡀⣰⣝⡯⣦⢷⡯⣿⣿⣗⣽⢪⣨⢽⠿⣯⡾⡵⠿⡫⢹⡀⡀⡀⡀⡀⢸⡀⡀⡀⡇⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠠⣿⣿⣞⣧⡞⢀⣶⢶⣾⣿⣀⣍⠻⠻⠿⣻⢰⢾⡯⡺⢻⠈⠉⠉⣿⣿⡇⣾⡮⢸⡀⡀⡀⡀⡀⢸⡀⡀⡀⡇⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡯⣿⣿⣷⣯⣽⠿⢿⡶⡿⠦⣄⣉⣈⣻⣻⡎⣺⣻⢞⣻⡀⡀⡀⢸⢽⢇⡽⡗⢸⡀⡀⡀⡀⡀⢸⡀⡀⡀⠃⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢀⠿⣤⠾⢿⣨⣟⣳⡿⠋⣠⣛⠶⠖⠒⡇⣿⣗⣻⡗⣺⢹⡀⡀⡀⠘⣞⢜⣝⡮⢸⡀⡀⡀⡀⡀⣾⡀⡀⢰⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣐⣈⣹⣄⣉⡉⠉⣬⣀⣠⠓⠒⡿⠛⠒⠚⠛⡈⣿⣯⣕⢝⢸⡀⡀⡀⡀⡯⡸⣯⣵⡃⡄⡀⡀⡀⣰⡾⡀⡀⢸⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⣰⢫⢁⡾⡀⡀⡀⡀⠈⠉⠓⠋⠚⠉⠉⡏⠈⠙⠁⠉⣹⣿⡹⡟⢝⢹⡀⡀⡀⡀⡿⠼⠭⠭⠖⡇⡀⡀⢀⢃⠃⡀⡀⠏⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⠂⡇⡟⡞⠇⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⢠⡀⡀⡀⡀⡀⡇⣇⠈⠉⠉⡀⡀⡀⡀⡀⠷⠤⣤⣤⢶⡁⡀⢀⠋⠟⡀⢀⠟⠂⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⢰⡀⡇⣗⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⣀⠏⡀⡀⣀⣤⠞⠛⢳⠉⠛⠛⠛⡖⠒⠒⠒⠒⢤⣤⣀⣀⡼⠖⢁⠿⠶⠛⠁⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⠩⠉⢙⠛⠛⠒⠒⠒⠒⠛⠛⠋⠉⠉⠩⡀⡀⠈⡀⡀⡀⠨⠉⠛⠍⠐⡀⡀⡀⡀⡀⠁⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀
[1-9] 音声  /  r ランダム  /  g ゲーミングｽﾋﾟｷ  /  q 終了
EOF
)

clear
echo "$AA"

# ===== 虹色グラデーションAA（固定位置）=====
rainbow_aa() {
  local frame=0
  local start_row=1

  # AAの高さを取得
  local height
  height=$(echo "$AA" | wc -l)

  while true; do
    tput cup $start_row 0

    local y=0
    while IFS= read -r line; do
      local x=0
      local out=""

      for ((i=0; i<${#line}; i++)); do
        ch="${line:i:1}"

        # 色相を位置＋時間でずらす
        local t=$((frame + x*3 + y*10))

        # sin波でRGB生成（0–255）
        r=$(awk "BEGIN{print int((sin(($t)*0.1)+1)*127)}")
        g=$(awk "BEGIN{print int((sin(($t)*0.1+2)+1)*127)}")
        b=$(awk "BEGIN{print int((sin(($t)*0.1+4)+1)*127)}")

        out+="\e[38;2;${r};${g};${b}m${ch}"
        ((x++))
      done

      echo -e "$out\e[0m"
      ((y++))
    done <<< "$AA"

    ((frame++))
    sleep 0.05
  done
}

# ランダム
random_loop() {
  while true; do
    $PLAYER "${VOICES[$((RANDOM % 9))]}" >/dev/null 2>&1
    sleep 0.2
  done
}


# ===== 後始末 =====
cleanup() {
  [ -n "$RAINBOW_PID" ] && kill "$RAINBOW_PID" 2>/dev/null
  [ -n "$RANDOM_PID" ] && kill "$RANDOM_PID" 2>/dev/null
  tput cnorm
  exit
}
trap cleanup EXIT

tput civis

# ===== キー入力（Enter不要）=====
while true; do
  read -rsn1 key
  case "$key" in
    [1-9])
      $PLAYER "${VOICES[$((key-1))]}" >/dev/null 2>&1 &
      ;;
    r)
      if [ "$RANDOM_MODE" -eq 0 ]; then
        RANDOM_MODE=1
        random_loop &
        RANDOM_PID=$!
      else
        RANDOM_MODE=0
        kill "$RANDOM_PID" 2>/dev/null
      fi
      ;;
    g)
      if [ "$RAINBOW" -eq 0 ]; then
        RAINBOW=1
        rainbow_aa &
        RAINBOW_PID=$!
      else
        RAINBOW=0
        kill "$RAINBOW_PID" 2>/dev/null
        clear
        echo "$AA"
      fi
      ;;
    q)
      exit
      ;;
  esac
done
